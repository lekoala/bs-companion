<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
  <title>Indeterminate progress bar demo</title>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />

  <meta name="theme-color" content="#111111" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#eeeeee" media="(prefers-color-scheme: dark)" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js" type="module"></script>

  <link href="./dist/demo.min.css" rel="stylesheet" />
  <link href="./dist/bs-companion.min.css" rel="stylesheet" />
  <script src="./dist/bs-companion.min.js" type="module"></script>
</head>

<body>
  <div class="container py-5">
    <h1>BS Companion</h1>
    <a href="index.html">Back</a>
    <hr />
    <h2>Indeterminate progress bars</h2>

    <p>Small</p>
    <div class="progress" role="progressbar" aria-label="Loading..." style="width:150px">
      <div class="progress-bar progress-bar-indeterminate"></div>
    </div>

    <hr>
    <p>Auto speed</p>
    <div class="progress progress-ratio" role="progressbar" aria-label="Loading..." style="width:300px">
      <div class="progress-bar progress-bar-indeterminate"></div>
    </div>

    <hr>
    <p>Manual speed = 3</p>
    <div class="progress" role="progressbar" aria-label="Loading..." style="--indeterminate-speed: 3">
      <div class="progress-bar progress-bar-indeterminate"></div>
    </div>

    <hr>

    <p>Auto speed (full width)</p>
    <div class="progress progress-ratio" role="progressbar" aria-label="Loading...">
      <div class="progress-bar progress-bar-indeterminate"></div>
    </div>

    <hr>

    <p>Auto speed (half width)</p>
    <div class="progress progress-ratio" role="progressbar" aria-label="Loading..." style="width:50%">
      <div class="progress-bar progress-bar-indeterminate"></div>
    </div>

    <hr>

    <div dir="rtl">
      <p>Rtl</p>
      <div class="progress progress-ratio" role="progressbar" aria-label="Loading...">
        <div class="progress-bar progress-bar-indeterminate"></div>
      </div>
    </div>

    <hr>

    <p>Easing</p>

    <div id="demo-bar" class="progress progress-ratio" role="progressbar" aria-label="Loading...">
      <div class="progress-bar progress-bar-indeterminate progress-bar-ease"></div>
    </div>
    <br />
    <button id="complete">Complete</button>
    <button id="start">Start</button>

    <script type="module">
      document.querySelector('#complete').addEventListener("click", (ev) => {
        const bar = document.querySelector('#demo-bar');
        const pbar = bar.firstElementChild;
        pbar.addEventListener('animationiteration', (ev) => {
          pbar.style.animationPlayState = "paused";
          pbar.style.animationFillMode = 'forwards';
        }, {
          once: true
        })
      });
      document.querySelector('#start').addEventListener("click", (ev) => {
        const bar = document.querySelector('#demo-bar');
        const pbar = bar.firstElementChild;
        pbar.style.animationPlayState = "running";
      });
      const els = document.querySelectorAll('.progress-ratio');
      els.forEach((el) => {
        let ratio = el.offsetWidth / 300;
        if (ratio > 8) ratio = ratio / 3;
        if (ratio > 4) ratio = ratio / 2;
        if (ratio < 0.5) ratio = 0.5;
        ratio = ratio.toFixed(2);
        el.style.setProperty('--indeterminate-speed', ratio);
        console.log("ratio set to", ratio);
      })
    </script>

    <hr>

    <p>Due to perceived speed depending on the progress bar size, we want to adjust the animation speed based on the size of the progress
      bar. It's not enough to simply divide by a given ratio as it needs to increase progressively.</p>

    <hr>
    <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles/progressbar_role">Progressbar role</a>

  </div>
</body>

</html>